
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">

    <title>Sticky Footer Navbar Template for Bootstrap</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/sticky-footer-navbar/">

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="main.js"></script>
    <!-- Custom styles for this template -->
    <link href="upload.css" rel="stylesheet">
</head>

<body onload="showFiles()">

    <header>
        <!-- Fixed navbar -->
        <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark" >
            
            <div class="collapse navbar-collapse" id="navbarCollapse">
            
            
            <ul class="navbar-nav mr-auto d-flex">
                   <li class="nav-item">
                    <div class="navbar-brand" >Deloitte</div>
                   </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="#" style="color:white"><span class="sr-only">Home</span> </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="upload.html" >Upload</a>
                    </li>
                    <li class="nav-item ">
                      <a class="nav-link" href="user_management.html">User Management</a>
                   </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link disabled" href="#">Disabled</a>
                    </li> -->
                </ul>
            <button type="button" class="btn btn-dark bg-dark d-flex ms-auto link-light " style="text-decoration: none; margin-inline:20px;" onclick="signoutbtn()">Sign Out</button>
            
            </div>
        </nav>
    </header>

   
<main>
  <div class ="rounded"style="margin-top:100px; border: radius 5px;">
  <div class="p-3 mb-2 bg-secondary text-white" id="welcome_user" >Welcome_deloitteUser</div>
  </div>
  <div class="row ms-2 mt-5">
    <div class="col-4">
      <p class="text-white bg-dark">List of Processed Files</p>
      <div class="list-group">
        <!--<a href="#" class="list-group-item list-group-item-action active" id = "selected" aria-current="true">
          The current link item
        </a>-->
          <p id="add_after_me"></p>
        <!--<button class="list-group-item list-group-item-action" id = "add_after_me" type = "button" onclick ="showDetails()">A second link item</button>-->
      </div>
    </div>
    <div class="col-8">
      <p class="text-white bg-dark">Document Metadata</p>
      <div class="row mt-3">
          <div class="col-4">
              
              <label type="button" id="file_name" class="btn btn-secondary">File Name</label>
             
          </div>
          <div class="col-8">
          <div class=" d-inline-flex" id="file_nametxt">Placeholder FileName</div>
          <button alt="Download" onclick ="Download()" class="btn btn-secondary mx-5" type="button" style="width:fit-content">download</button>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-4">
          <label type="button"  id = "created_by" class="btn btn-secondary">Created By</label>
        </div>
        <div class="col-8 d-inline-flex" id="created_bytxt">Placeholder FullName</div>
      </div>
      <div class="row mt-3">
        <div class="col-4">
            <label type="button" id="created_on" class="btn btn-secondary">Created On</label>
        </div>
        <div class="col-8 d-inline-flex" id="created_ontxt">DD/MM/YY</div>
      </div>
     
    </div>
  </div>
</main>

  <footer class="page-footer fixed-bottom bg-dark text-center font-small mt-4 wow fadeIn  ">

  <div class="footer-container1" >
    Footer
    
  </div>
  <div class="bg-dark footer-container2">
    <div style="color:white;text-align: left;">
        Footer links and menu items.
    </div>
    <div style="color:white;text-align: left;">
       Copyright@Deloitte.com | 2021
    </div>
  </div>
  
</footer>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="../../assets/js/vendor/popper.min.js"></script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script>
        var total_length;
        var cur_userid;
        //an onload function
        function showFiles() {
            var i = 0;

            // Get current User Id
           
            var settingsCurUserId = {
                "url": "http://localhost:5000/api/Session/GetId",
                "method": "GET",
                "timeout": 0,
                "async": false
            };
            $.ajax(settingsCurUserId).done(function (response) {
                cur_userid = response;
            }).fail(function (response) {
                alert("fail");
            });
            //Get current user name
            //getting session details
            var name, firstname, lastname;
            var settingsFName = {
                "url": "http://localhost:5000/api/Session/GetfirstName",
                "method": "GET",
                "timeout": 0,
                "async": false
            };

            $.ajax(settingsFName).done(function (response) {
                firstname = response;
            }).fail(function (response) {
                alert("fail");
            });


            var settingsLName = {
                "url": "http://localhost:5000/api/Session/GetlastName",
                "method": "GET",
                "timeout": 0,
                "async": false
            };

            $.ajax(settingsLName).done(function (response) {
                lastname = response;
            }).fail(function (response) {
                alert("fail");
            });

            name ="Welcome " + firstname + " " + lastname;
            
            document.getElementById("welcome_user").innerHTML = name;


            // Get a list of names of the files uploaded by the current user
            var listOfFileNames;
            url_FileNames = "http://localhost:5000/api/Metadata/GetMetadataFileNames/?username=" + cur_userid;
            var settingsFN = {
                "url": url_FileNames,
                "method": "GET",
                "timeout": 0,
                "async": false
           };
            $.ajax(settingsFN).done(function (response) {
                listOfFileNames = response;
                total_length = response.length;
            });

            // Get a list of Ids of the files uploaded by the current user
            var listOfIds;
            url_Ids = "http://localhost:5000/api/Metadata/GetMetadataIds/?username=" + cur_userid;
            var settingsFN = {
                "url": url_Ids,
                "method": "GET",
                "timeout": 0,
                "async": false
            };
            $.ajax(settingsFN).done(function (response) {
                listOfIds = response;
            });

            for (i = 0; i < total_length; i++) {
                var listitem = '<button class= "list-group-item list-group-item-action" id = "'
                listitem += listOfIds[i];
                listitem += '" type = "button" onclick ="showDetails(this)">';
                listitem += listOfFileNames[i];
                listitem += '</button>';
                document.getElementById("add_after_me").insertAdjacentHTML("afterend", listitem);
            }
        }
        //a clickable function
        function showDetails(ele) {
            var smt = ele.id;
           
            //change color of all buttons to white
           
            //for (i = 1; i <= total_length; i++) {
            //    var btn_id = i.toString();
            //    document.getElementById(btn_id).style.backgroundColor = 'red';
            //}
         
            //redundunt-region

            // Get a list of Ids of the files uploaded by the current user
            var listOfIds;
            
            url_Ids = "http://localhost:5000/api/Metadata/GetMetadataIds/?username=" + cur_userid;
            var settingsFN = {
                "url": url_Ids,
                "method": "GET",
                "timeout": 0,
                "async": false
            };
            $.ajax(settingsFN).done(function (response) {
                listOfIds = response;
            });
            
          
            for (i = 0; i < total_length; i++) {
                cur_id = listOfIds[i].toString();
                document.getElementById(cur_id).style.backgroundColor = 'white';
                document.getElementById(cur_id).style.color = 'black';
            }
          
            //stops here
            // change color of this button to blue
            document.getElementById(smt).style.backgroundColor = '#0184fc';
            document.getElementById(smt).style.color = 'white';

            //showing details


            var url1 = "http://localhost:5000/api/Metadata/";
            url1 += smt;

            var settings = {
                "url": url1,
                "method": "GET",
                "timeout": 0,
            };

            $.ajax(settings).done(function (response) {

                document.getElementById("file_nametxt").innerHTML = response[2];
                document.getElementById("created_bytxt").innerHTML = response[0];
                document.getElementById("created_ontxt").innerHTML = response[1];
            });

        }
        //a clickable function
        function Download() {
            var fn = document.getElementById("file_nametxt").innerHTML.toString();
            var url_downl = "http://localhost:5000/api/File/Download?fileName=";
            url_downl += fn;

            var requestOptions = {
                method: 'GET',
                redirect: 'follow',
                async: false
            };

            fetch(url_downl, requestOptions)
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    // the filename you want
                    a.download = fn;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                });
        }
    </script>
</body>

</html>