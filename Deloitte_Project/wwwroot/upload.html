
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">

    <title>Sticky Footer Navbar Template for Bootstrap</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/sticky-footer-navbar/">

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="upload.css" rel="stylesheet">
</head>

<body>

    <header>
        <!-- Fixed navbar -->
        <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">

            <div class="collapse navbar-collapse" id="navbarCollapse">


                <ul class="navbar-nav mr-auto d-flex">
                    <li class="nav-item">
                        <div class="navbar-brand">Deloitte</div>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="Home.html">Home </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="#" style="color:white">Upload<span class="sr-only"></span></a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="user_management.html">User Management</a>
                    </li>
                </ul>
                <button type="button" class="btn btn-dark bg-dark d-flex ms-auto link-light " style="text-decoration: none; margin-inline:20px;" onclick="signoutbtn()">Sign Out</button>

            </div>
        </nav>
    </header>
    <main>
        <div class="container mt-4">

            <div class="container welcome rounded" style="position: relative;">

                <div class="spacer"> </div>
                <div style="left:0; bottom:0; position: absolute; margin-left: 10px; " class="mb-4">
                    <div class="mt-10 display-6">
                        Welcome to Application
                    </div>
                    <div class="mb-4">
                        Traffic Predictabilty
                    </div>

                </div>
            </div>
            <div class="container ms-auto text-center" style="margin-top:20px;">

                <input type="file" id="fileUpload">
                <button type="button" class="btn btn-secondary" onclick="uploadfile()">Upload</button>

            </div>
            <div class="text-center" id="for_alert">

            </div>





        </div>
    </main>
    <footer class="page-footer fixed-bottom bg-dark text-center font-small mt-4 wow fadeIn  ">

        <div class="footer-container1 mb-3">
            Footer

        </div>
        <div class="bg-dark footer-container2">
            <div class="footer_links mt-3">
                <h6>
                Footer links and menu items.
                </h6>
            </div>
            <div class="copyright" >
                <small>
                    Copyright@Deloitte.com | 2022

                </small>
          
            </div>
        </div>

    </footer>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="../../assets/js/vendor/popper.min.js"></script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="main.js"></script>
</body>
<script>
    function uploadfile() {
        var form = new FormData();
        const fileInput = document.getElementById('fileUpload');
        if (fileInput.files[0].name.endsWith(".pbix")) {
            var currentdate = new Date();
            var datetime = currentdate.getDate() + "/"
                + (currentdate.getMonth() + 1) + "/"
                + currentdate.getFullYear();

            //getting session details
            var name, firstname, lastname, userid;
            var settingsFName = {
                "url": "http://localhost:5000/api/Session/GetfirstName",
                "method": "GET",
                "timeout": 0,
                "async": false
            };

            $.ajax(settingsFName).done(function (response) {
                firstname = response;
            }).fail(function (response) {
                alert("fail");
            });


            var settingsLName = {
                "url": "http://localhost:5000/api/Session/GetlastName",
                "method": "GET",
                "timeout": 0,
                "async": false
            };

            $.ajax(settingsLName).done(function (response) {
                lastname = response;
            }).fail(function (response) {
                alert("fail");
            });

            name = firstname + " " + lastname;

            var settingsUserId = {
                "url": "http://localhost:5000/api/Session/GetId",
                "method": "GET",
                "timeout": 0,
                "async": false
            };
            $.ajax(settingsUserId).done(function (response) {
                userid = response;
            }).fail(function (response) {
                alert("fail");
            });


            // Metadata push
            var data = JSON.stringify({
                "file_name": fileInput.files[0].name,
                "created_on": datetime,
                "created_by": name,
                "userid": userid
            });

            var xhr = new XMLHttpRequest();
            xhr.withCredentials = true;

            xhr.addEventListener("readystatechange", function () {
                if (this.readyState === 4) {
                    console.log(this.responseText);
                }
            });

            xhr.open("POST", "http://localhost:5000/api/Metadata", false);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
            xhr.send(data);

            // File Upload
            var upload_data = new FormData();
            upload_data.append("formFiles", fileInput.files[0], fileInput.files[0].name);

            var upload_xhr = new XMLHttpRequest();
            upload_xhr.withCredentials = true;

            upload_xhr.addEventListener("readystatechange", function () {
                if (this.readyState === 4) {
                    console.log(this.responseText);
                    alertmessage("Uploaded Sucessfully!", 'success');
                    document.getElementById("fileUpload").value = null;
                }
            });

            upload_xhr.open("POST", "http://localhost:5000/api/File/Upload", false);
            upload_xhr.send(upload_data);
        } else {
          
            alertmessage("Upload failure! Only pbix file type is supported.", 'danger');
            document.getElementById("fileUpload").value = null;
        }
    }

    function alertmessage(message, type) {

        $("#for_alert").fadeIn();
        const wrapper = document.createElement('div');
        wrapper.innerHTML = [
            `<div class="alert alert-${type} alert-dismissible text-center mx-auto mt-3 "style="width:fit-content; height:fit-content;" role="alert">`,
            `   <div class="mx-auto text-center">${message}</div>`,

            '</div>'
        ].join('');
        document.getElementById("for_alert").innerHTML = wrapper.innerHTML;
        $("#for_alert").delay(2000).fadeOut();
    }

</script>
</html>